<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Match Pilot</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/components.css" />
    <link rel="stylesheet" href="/css/kanban.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.5/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.1/Sortable.min.js"></script>
  </head>
  <body>
    <nav class="top-nav" aria-label="Primary">
      <a class="active" href="/">Dashboard</a>
      <a href="/stored-jobs.html">Stored Jobs</a>
      <button id="logout-btn" class="nav-logout" type="button">Logout</button>
    </nav>
    <header class="site-header">
      <div class="site-header-row">
        <div>
          <p class="eyebrow">Match Pilot</p>
          <h1>Find, Rank, and Track Jobs</h1>
          <p>Upload your resume, discover high-fit roles, and run your applications like an operating pipeline.</p>
        </div>
        <aside class="workspace-meta" aria-label="Workspace context">
          <p class="workspace-label">Workspace</p>
          <p class="workspace-title">Personal Job Operations</p>
          <div class="workspace-chips">
            <span>Local First</span>
            <span>Resume Matched</span>
            <span>Live Search</span>
          </div>
        </aside>
      </div>
      <section class="stats-strip">
        <article class="stat-card">
          <p class="stat-label">Jobs in View</p>
          <p id="stat-jobs" class="stat-value">0</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Average Match</p>
          <p id="stat-match" class="stat-value">0%</p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Tracked Applications</p>
          <p id="stat-apps" class="stat-value">0</p>
        </article>
      </section>
    </header>

    <main class="layout">
      <section class="panel" id="resume-panel">
        <h2>Resume</h2>
        <p class="panel-subtitle">Upload and switch your active profile for matching and cover letters.</p>
        <form id="resume-upload-form">
          <input type="file" id="resume-file" accept=".pdf,.docx" required />
          <button type="submit">Upload Resume</button>
        </form>
        <div class="field-group">
          <label for="active-resume">Active Resume</label>
          <select id="active-resume"></select>
        </div>
        <ul id="resume-list" class="list"></ul>
      </section>

      <section class="panel" id="search-panel">
        <h2>Job Search</h2>
        <p class="panel-subtitle">Run cross-source search, apply precision filters, and keep either the latest result or an accumulating session set.</p>
        <form id="job-search-form" class="grid-form">
          <div class="field-group">
            <label for="keywords">Keywords</label>
            <input id="keywords" type="text" placeholder="Data Engineer" required />
          </div>
          <div class="field-group">
            <label for="location">Location</label>
            <input id="location" type="text" placeholder="Berlin, Germany" required />
          </div>
          <div class="field-group">
            <label for="salary-min">Minimum Salary (â‚¬)</label>
            <input id="salary-min" type="number" min="0" step="1000" />
          </div>
          <section class="filter-block field-wide" aria-label="Advanced search filters">
            <div class="filter-block-head">
              <h3>Advanced Filters</h3>
              <p>Refine by location precision, match quality, recency, experience, and work mode.</p>
            </div>
            <div class="filter-grid">
              <div class="field-group">
                <label for="filter-location">Location Contains</label>
                <input id="filter-location" type="text" placeholder="Berlin" />
              </div>
              <div class="field-group">
                <label for="match-min">Match Min (%)</label>
                <input id="match-min" type="number" min="0" max="100" step="1" placeholder="50" />
              </div>
              <div class="field-group">
                <label for="match-max">Match Max (%)</label>
                <input id="match-max" type="number" min="0" max="100" step="1" placeholder="100" />
              </div>
              <div class="field-group">
                <label for="date-posted">Date Posted</label>
                <select id="date-posted">
                  <option value="">Any recent (max 21 days)</option>
                  <option value="last_1h">Last 1 hour</option>
                  <option value="last_4h">Last 4 hours</option>
                  <option value="last_8h">Last 8 hours</option>
                  <option value="last_24h">Last 24 hours</option>
                  <option value="last_3_days">Last 3 days</option>
                  <option value="last_7_days">Last 7 days</option>
                  <option value="last_14_days">Last 14 days</option>
                  <option value="last_21_days">Last 21 days</option>
                </select>
              </div>
            </div>
            <div class="filter-grid filter-grid-choices">
              <div class="field-group">
                <label>Experience Level</label>
                <div class="inline-checks compact-checks">
                  <label><input type="checkbox" name="experience-level" value="entry" /> Entry</label>
                  <label><input type="checkbox" name="experience-level" value="junior" /> Junior</label>
                  <label><input type="checkbox" name="experience-level" value="mid" /> Mid</label>
                  <label><input type="checkbox" name="experience-level" value="senior" /> Senior</label>
                  <label><input type="checkbox" name="experience-level" value="lead" /> Lead</label>
                </div>
              </div>
              <div class="field-group">
                <label>Work Mode</label>
                <div class="inline-checks compact-checks">
                  <label><input type="checkbox" name="work-mode" value="onsite" /> Onsite</label>
                  <label><input type="checkbox" name="work-mode" value="hybrid" /> Hybrid</label>
                  <label><input type="checkbox" name="work-mode" value="remote" /> Remote</label>
                </div>
              </div>
              <div class="field-group">
                <label>Resume Relevancy</label>
                <div class="inline-checks compact-checks">
                  <label><input type="checkbox" name="relevancy" value="strong" /> Strong (70%+)</label>
                  <label><input type="checkbox" name="relevancy" value="good" /> Good (50-69%)</label>
                  <label><input type="checkbox" name="relevancy" value="possible" /> Possible (&lt;50%)</label>
                </div>
              </div>
            </div>
          </section>
          <div class="field-group field-wide">
            <label>Sources</label>
            <div class="inline-checks">
              <label><input type="checkbox" name="source" value="indeed" checked /> Indeed</label>
              <label><input type="checkbox" name="source" value="stepstone" checked /> StepStone</label>
              <label><input type="checkbox" name="source" value="linkedin" checked /> LinkedIn</label>
              <label><input type="checkbox" name="source" value="arbeitnow" checked /> Arbeitnow</label>
              <label><input type="checkbox" name="source" value="berlinstartupjobs" checked /> BerlinStartupJobs</label>
            </div>
          </div>
          <div class="field-group field-wide">
            <label>Result Mode</label>
            <div class="segment-control" role="radiogroup" aria-label="Result mode">
              <label><input type="radio" name="result-mode" value="session" checked /> Accumulate Session</label>
              <label><input type="radio" name="result-mode" value="latest" /> Latest Search Only</label>
            </div>
          </div>
          <div class="form-actions">
            <button id="search-submit-btn" type="submit">Search Jobs</button>
          </div>
        </form>
        <div class="results-toolbar">
          <div id="search-meta" class="meta" aria-live="polite"></div>
          <div class="stored-actions">
            <button id="clear-search-results" type="button" class="quiet-btn">Clear Session Results</button>
            <button id="clear-stored-jobs-dashboard" type="button" class="danger-btn">Clear All Stored Jobs</button>
          </div>
        </div>
        <div id="source-breakdown" class="source-breakdown"></div>
        <div id="job-results" class="job-grid"></div>
      </section>

      <section class="panel" id="applications-panel">
        <div class="panel-title-row">
          <div>
            <h2>Application Tracker</h2>
            <p class="panel-subtitle">Drag cards between stages to keep your pipeline current.</p>
          </div>
          <div class="stored-actions">
            <button id="refresh-apps" type="button" class="quiet-btn">Refresh</button>
            <button id="delete-selected-apps" type="button" class="danger-btn">Delete Selected</button>
            <button id="clear-all-apps" type="button" class="danger-btn">Clear All</button>
          </div>
        </div>
        <div id="apps-selection-meta" class="meta"></div>
        <div id="kanban-board" class="kanban-board">
          <div class="kanban-column" data-status="to_apply">
            <h3>To Apply <span id="count-to_apply" class="lane-count">0</span></h3>
            <div class="kanban-list" id="to_apply"></div>
          </div>
          <div class="kanban-column" data-status="applied">
            <h3>Applied <span id="count-applied" class="lane-count">0</span></h3>
            <div class="kanban-list" id="applied"></div>
          </div>
          <div class="kanban-column" data-status="interviewing">
            <h3>Interviewing <span id="count-interviewing" class="lane-count">0</span></h3>
            <div class="kanban-list" id="interviewing"></div>
          </div>
          <div class="kanban-column" data-status="rejected">
            <h3>Rejected <span id="count-rejected" class="lane-count">0</span></h3>
            <div class="kanban-list" id="rejected"></div>
          </div>
          <div class="kanban-column" data-status="accepted">
            <h3>Accepted <span id="count-accepted" class="lane-count">0</span></h3>
            <div class="kanban-list" id="accepted"></div>
          </div>
        </div>
      </section>
    </main>

    <dialog id="cover-letter-modal">
      <form method="dialog" id="cover-letter-form">
        <h3>Generate Cover Letter</h3>
        <div class="field-group">
          <label for="tone">Tone</label>
          <select id="tone">
            <option value="professional">Professional</option>
            <option value="enthusiastic">Enthusiastic</option>
            <option value="concise">Concise</option>
          </select>
        </div>
        <div class="field-group">
          <label for="custom-intro">Custom Intro</label>
          <textarea id="custom-intro" rows="4" placeholder="Optional intro..."></textarea>
        </div>
        <input id="cover-letter-job-id" type="hidden" />
        <menu>
          <button value="cancel" type="button" id="close-cover-letter">Close</button>
          <button value="default" type="submit">Generate</button>
        </menu>
      </form>
      <article id="cover-letter-output" class="cover-letter-output"></article>
    </dialog>

    <div id="toast" class="toast"></div>

    <script type="module" src="/js/app.js"></script>
  </body>
</html>
